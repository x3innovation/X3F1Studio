<polymer-element name="fmx-task-editor" class="modal-content">
    <template>
        <h1>Edit task</h1>
        <form>
            <label> Task name
                <input type="text" value="{{ name }}" required>
            </label>
            <label> Description 				<textarea value="{{ description }}"></textarea> </label>
            <div class="toolbar">
                <button on-click="{{ send }}" class="{{ { disabled: !canSend } | tokenList }}">
                    Save
                </button>
                <a on-click="{{ close }}">Cancel</a>
            </div>
        </form>
    </template>
    <script>
        Polymer('fmx-task-editor', {
            graph: null,
            node: null,
            name: '',
            description: '',
            attached: function() {
                this.name = this.node.metadata.label;
                this.description = this.node.metadata.description;
            },
            nameChanged: function() {
                if (!this.name) {
                    this.canSend = false;
                    return;
                }
                this.canSend = true;
            },
            send: function(event) {
                if (event) {
                    event.preventDefault();
                }
                if (!this.name) {
                    return;
                }
                var node =  this.clone(this.graph.getNode(this.node.id));
                node.metadata['label'] = this.name;
                node.metadata['description'] = this.description;            
                fmx.doc.tasks.set(this.node.id, node);

                this.close();
            },
            close: function() {
                if (!this.parentNode) {
                    return;
                }
                this.parentNode.removeChild(this);
            },
            clone: function(obj) {
                var flags, key, newInstance;
                if ((obj == null) || typeof obj !== 'object') {
                    return obj;
                }
                if (obj instanceof Date) {
                    return new Date(obj.getTime());
                }
                if (obj instanceof RegExp) {
                    flags = '';
                    if (obj.global != null) {
                        flags += 'g';
                    }
                    if (obj.ignoreCase != null) {
                        flags += 'i';
                    }
                    if (obj.multiline != null) {
                        flags += 'm';
                    }
                    if (obj.sticky != null) {
                        flags += 'y';
                    }
                    return new RegExp(obj.source, flags);
                }
                newInstance = new obj.constructor();
                for (key in obj) {
                    newInstance[key] = this.clone(obj[key]);
                }
                return newInstance;
            }
        });
    </script>
</polymer-element>
